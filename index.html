<!DOCTYPE html>
<html lang="en">
<head>  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" id="metaDescription" content="Read inspiring stories and educational insights on Samuwa Edukates ‚Äì your daily source of motivation." />
  <title>Samuwa Edukates</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    :root{
      --primary:#ff7043;
      --accent:#fbc02d;
      --bg:#fffaf3;
      --text:#2c2c2c;
      --muted:#666;
      --card:#ffffff;
      --shadow:0 6px 14px rgba(0,0,0,.08);
      --footer:#d84315;
      --footer2:#ad1457;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Roboto',sans-serif;background:var(--bg);color:var(--text);line-height:1.6}

    header{position:sticky;top:0;z-index:50;background:var(--primary);color:#fff;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 4px 10px rgba(0,0,0,.1)}
    .logo{display:flex;align-items:center;font-family:'Times New Roman',serif;font-size:24px;font-weight:bold}
    .logo img{height:42px;margin-right:10px;border-radius:6px}
    .hamburger{font-size:28px;cursor:pointer;display:none}
    .nav{display:flex;gap:20px}
    .nav a{color:#fff;text-decoration:none;font-weight:500}
    .nav a:hover{opacity:.85}

    .post-container{max-width:900px;margin:40px auto;padding:0 20px}
    .post-card{background:var(--card);border-radius:12px;box-shadow:var(--shadow);overflow:hidden}
    .post-content{padding:20px}
    .post-title{font-size:30px;font-weight:700;margin:10px 0;color:#222}

    .meta-row{display:flex;flex-wrap:wrap;gap:12px;align-items:center;font-size:14px;color:var(--muted);margin-bottom:16px}
    .meta-item{display:inline-flex;align-items:center;gap:6px}
    .meta-dot::before{content:"‚Ä¢";margin:0 6px}

    .post-media img{width:100%;max-height:460px;display:block;object-fit:cover}

    .post-body{padding:20px}
    .post-body img{max-width:100%;border-radius:8px;margin:10px 0}

    .share{margin:30px 20px}
    .share span{display:block;font-weight:600;margin-bottom:10px}
    .share a{margin-right:12px;font-size:20px;color:var(--primary);text-decoration:none}
    .share a:hover{opacity:.8}

    .related{padding:0 20px 24px}
    .related h3{margin:10px 0 14px;font-size:20px;font-weight:700;color:#222}
    .related-list{list-style:none;padding:0;margin:0}
    .related-list li{margin:8px 0}
    .related-list a{text-decoration:none;color:var(--primary);font-weight:500}
    .related-list a:hover{text-decoration:underline}

    footer{background:linear-gradient(45deg,var(--footer),var(--footer2));color:#fff;padding:50px 20px 20px;margin-top:50px}
    .footer-container{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:30px}
    .footer-col h4{margin-bottom:15px;font-size:18px;font-weight:700}
    .footer-col p{font-size:14px;line-height:1.6;opacity:.9}
    .footer-col a{display:block;color:#fff;text-decoration:none;font-size:14px;margin:6px 0;opacity:.9}
    .footer-col a:hover{opacity:1;text-decoration:underline}
    .social-links{display:flex;gap:14px;margin-top:8px}
    .social-links a{font-size:18px;color:#fff}
    .newsletter input[type="email"]{width:100%;padding:10px;border-radius:6px;border:none;margin-bottom:10px}
    .newsletter button{width:100%;padding:10px;border:none;border-radius:6px;background:var(--accent);color:#000;font-weight:600;cursor:pointer}
    .newsletter button:hover{background:#f9a825}
    .footer-bottom{text-align:center;margin-top:30px;font-size:13px;opacity:.85}

    @media(max-width:768px){
      .hamburger{display:block}
      .nav{display:none;flex-direction:column;position:absolute;top:60px;right:20px;background:var(--primary);padding:14px;border-radius:10px}
      .nav.show{display:flex}
      .post-title{font-size:24px}
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="logo">
      <img src="https://res.cloudinary.com/dkoagpcul/image/upload/v1753858825/file_000000008bd461f489ab78e732435eba_tiqllb.png" alt="Samuwa Edukates Logo">
      Samuwa Edukates
    </div>
    <div class="hamburger" id="hamburger">‚ò∞</div>
    <nav class="nav" id="navMenu">
      <a href="index.html">Home</a>
      <a href="index.html#inspire">Inspire Me</a>
      <a href="index.html#news">News</a>
      <a href="index.html#contact">Contact</a>
    </nav>
  </header>

  <!-- Post -->
  <article class="post-container">
    <div class="post-card">
      <div class="post-content">
        <h1 class="post-title" id="postTitle">Loading...</h1>

        <div class="meta-row">
          <div class="meta-item"><i class="fa-regular fa-user"></i><strong id="postAuthor">Author</strong></div>
          <div class="meta-item meta-dot"><i class="fa-regular fa-calendar"></i><time id="postDate"></time></div>
          <div class="meta-item meta-dot"><span aria-hidden="true">üëÅÔ∏è</span><span id="postViews">0</span> views</div>
        </div>
      </div>

      <div class="post-media">
        <img id="postImage" src="https://via.placeholder.com/1200x460?text=Loading..." alt="Post Featured Image">
      </div>

      <div class="post-body" id="postBody"></div>

      <div class="share">
        <span>Share this post:</span>
        <a id="shareFacebook" target="_blank"><i class="fab fa-facebook-f"></i></a>
        <a id="shareTwitter" target="_blank"><i class="fab fa-x-twitter"></i></a>
        <a id="shareLinkedIn" target="_blank"><i class="fab fa-linkedin-in"></i></a>
        <a id="shareWhatsApp" target="_blank"><i class="fab fa-whatsapp"></i></a>
      </div>

      <div class="related">
        <h3>Related Posts</h3>
        <ul class="related-list" id="relatedPosts"></ul>
      </div>
    </div>
  </article>

  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-col">
        <h4>About Us</h4>
        <p>Samuwa Edukates shares inspirational stories and educational content to spark creativity, positivity, and personal growth.</p>
      </div>
      <div class="footer-col">
        <h4>Quick Links</h4>
        <a href="index.html">Home</a>
        <a href="index.html#inspire">Inspire Me</a>
        <a href="index.html#news">News</a>
        <a href="index.html#contact">Contact</a>
      </div>
      <div class="footer-col">
        <h4>Follow Us</h4>
        <div class="social-links">
          <a href="https://www.facebook.com/profile.php?id=61578932424898" target="_blank"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-x-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-linkedin-in"></i></a>
        </div>
      </div>
      <div class="footer-col newsletter">
        <h4>Newsletter</h4>
        <p>Subscribe for weekly inspiration and updates.</p>
        <form>
          <input type="email" placeholder="Enter your email">
          <button type="submit">Subscribe</button>
        </form>
      </div>
    </div>
    <div class="footer-bottom">
      &copy; <span id="footerYear"></span> Samuwa Edukates. All rights reserved.
    </div>
  </footer>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-lite.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAwAxP-MWwNnKP59PA6joil4Ceq10eozlc",
      authDomain: "wafula-s-educational-posts.firebaseapp.com",
      projectId: "wafula-s-educational-posts"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.getElementById("footerYear").textContent = new Date().getFullYear();
    document.getElementById("hamburger").addEventListener("click",()=>document.getElementById("navMenu").classList.toggle("show"));

    function extractFirstImage(html){
      if (!html) return null;
      const parser = new DOMParser();
      const d = parser.parseFromString(html, "text/html");
      const img = d.querySelector("img");
      return img ? img.getAttribute("src") : null;
    }
    function stripFirstImage(html){
      if (!html) return "";
      return html.replace(/<img[^>]*>/i,""); // remove only the first <img>
    }
    function stripHTML(s){ return s ? s.replace(/<[^>]*>?/gm,"") : ""; }
    function formatDate(ts){
      try{
        if(ts && typeof ts === "object" && "seconds" in ts){ return new Date(ts.seconds*1000).toLocaleDateString(); }
        return ts ? new Date(ts).toLocaleDateString() : "";
      }catch(_){ return ""; }
    }

    const params = new URLSearchParams(window.location.search);
    const postId = params.get("id");

    async function loadPost(){
      if(!postId) return;
      const ref = doc(db,"posts",postId);
      const snap = await getDoc(ref);
      if(!snap.exists()) return;

      const post = snap.data();
      const firstImg = extractFirstImage(post.article);
      const cleanArticle = stripFirstImage(post.article);
      const views = typeof post.views === "number" ? post.views : 0;

      document.getElementById("postTitle").textContent = post.title || "Untitled";
      document.getElementById("postAuthor").textContent = post.author || "Samuwa Edukates";
      document.getElementById("postDate").textContent = formatDate(post.timestamp);
      document.getElementById("postImage").src = firstImg || "https://via.placeholder.com/1200x460?text=No+Image";
      document.getElementById("postBody").innerHTML = cleanArticle || "";
      document.getElementById("postViews").textContent = views;

      document.title = `${post.title || "Post"} ‚Äì Samuwa Edukates`;
      const firstParagraph = stripHTML(cleanArticle||"").split(".").filter(Boolean)[0] || "Read inspiring stories and educational insights.";
      document.querySelector("#metaDescription").setAttribute("content", firstParagraph);

      const pageUrl = encodeURIComponent(window.location.href);
      const pageTitle = encodeURIComponent(post.title || "Samuwa Edukates");
      document.getElementById("shareFacebook").href = `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}`;
      document.getElementById("shareTwitter").href = `https://twitter.com/intent/tweet?url=${pageUrl}&text=${pageTitle}`;
      document.getElementById("shareLinkedIn").href = `https://www.linkedin.com/sharing/share-offsite/?url=${pageUrl}`;
      document.getElementById("shareWhatsApp").href = `https://wa.me/?text=${pageTitle}%20${pageUrl}`;

      try{
        await updateDoc(ref, { views: views + 1 });
        document.getElementById("postViews").textContent = views + 1;
      }catch(e){ console.warn("Views update failed:", e); }

      loadRelatedPosts(postId);
    }

    async function loadRelatedPosts(currentPostId){
      const qRef = query(collection(db,"posts"), orderBy("timestamp","desc"), limit(10));
      const relatedSnap = await getDocs(qRef);
      const relatedContainer = document.getElementById("relatedPosts");
      relatedContainer.innerHTML = "";
      let added = 0;

      relatedSnap.forEach(d=>{
        if(added >= 6) return;
        if(d.id === currentPostId) return;
        const p = d.data();
        const cat = (p.category || "").toLowerCase();
        if(cat === "news") return;
        const li = document.createElement("li");
        li.innerHTML = `<a href="post.html?id=${d.id}">${p.title || "Untitled"}</a>`;
        relatedContainer.appendChild(li);
        added++;
      });
    }

    loadPost();
  </script>
</body>
</html>